{% extends 'base.html' %}{% block nav %}
<!-- long url and shorten url input div starts -->
<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text">
            Long URL
        </span>
    </div>
    <input type=url class="form-control" value="{{data['longurl']}}">
</div>
<div class="input-group mb-3">
    <div class="input-group-prepend">
        <span class="input-group-text">
            Shorten URL
        </span>
    </div>
    <input type=url id="shorturl" class="form-control" value="{{ handler.gerIP }}{{ data['scode'] }}">
    <button style="font-size:16px" class="btnCopy fa fa-copy btnCopy" data-clipboard-target=#shorturl>
    </button>
</div>
<!-- long url and shorten url input div ends -->
<hr>
<p class="text-center">Quick Acess QR Code</p>
<div id="qrcode" class="text-center"></div>
<hr>
<div class="row">
    <div class="col-md-6">
        <a class="btn  btn-block" style="background-color: #008d36;" href="/">Generating More</a>
    </div>
    <div class="col-md-6">
        <a class="btn  btn-block" style="background-color: #008d36;" href="/static/Layouts/staticurl.html">Viewing
            Report</a>
    </div>
</div>
<hr>
<div class=" row">
    <div class="col-md-6">
        <div class="alert alert-success">Visitors of the day:{{data['day_visitor']}}</div>
    </div>
    <div class="col-md-6">
        <div class="alert alert-success">Total vistors:{{data['total_vistor']}}</div>
    </div>
</div>
<hr>

<table class="table table-hover" id="tbhover" data-id="1">
    {% raw xsrf_form_html() %}
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">URL</th>
            <th scope="col">IP</th>
            <th scope="col">Location</th>
            <th scope="col">Method</th>
            <th scope="col">Time</th>
        </tr>
    </thead>
</table>


<a data-id="1" id="get_more" class="btn">Next</a>
<div id="finish_loading"></div>

<script>
    $(document).ready(function() {
        // <!--set qrcode width and height and etc -- >
        $("#qrcode ").qrcode({
            render: "canvas",
            width: 200,
            height: 200,
            text: "{{ handler.gerIP }}{{ data['scode'] }}",
            backgroud: "#4f4f4f",
            foreground: "#008d36"
        })

        function getCookie(name) {
            var c = document.cookie.match("\\b" + name + "=([^;]*)\\b");
            return c ? c[1] : undefined;
        }

        function getPageData(pageNumber) {
            $.ajax({
                url: '/overview',
                data: {
                    pageNumber: pageNumber,
                    _xsrf: getCookie("_xsrf"),
                    uuid: "{{data['uuid'].uuid}}"
                },
                datatype: 'json',
                type: 'POST',
                success: function(result) {
                    if (result.statuscode == 200) {
                        var datainfo = result.datainfo;
                        for (var dataValue in datainfo) {
                            var html = '<tr><td>' + datainfo[dataValue]['id'] + '</td><td>' + datainfo[dataValue]['short_url'] + '</td><td>' + datainfo[dataValue]['short_url_requestIP'] + '</td><td>' + datainfo[dataValue]['short_url_requestLocation'] + '</td><td>' + datainfo[dataValue]['short_url_requestMethod'] + '</td><td>' + datainfo[dataValue]['short_url_createTime'] + '</td></tr>';
                            $('#tbhover').append(html);
                        }
                    } else {
                        $('#finish_loading').empty();
                        $('#finish_loading').append(
                            '<span> no more data avaliable! </span>'
                        );
                    }
                }
            })
        }
        getPageData(1);

        $("#get_more").click(function() {
            var pageNumber = parseInt($(this).attr("data-id")) + 1;
            getPageData(pageNumber);
            $(this).attr("data-id", pageNumber);
        })
    });
</script>
<script>
    toastr.options = {
        "positionClass": "toast-top-center ",
        "timeOut": "300"
    };
    var clipboard = new ClipboardJS('.btnCopy');
    clipboard.on('success', function(e) {
        toastr.success('Short Url Copied');
    });
</script>


{% end %}